{% extends "bookings/base.html" %}
{% block title %}Movies{% endblock %}
{% block content %}
  <h1 class="mb-3">Movies</h1>
  <div id="movies" class="row g-3"></div>

  <script>
    async function loadMovies() {
      const res = await fetch("/api/movies/");
      const data = await res.json();
      const grid = document.getElementById("movies");
      grid.innerHTML = "";
      data.forEach(m => {
        const col = document.createElement("div");
        col.className = "col-md-4";
        col.innerHTML = `
          <div class="card h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${m.title}</h5>
              <p class="card-text flex-grow-1">${m.description || ""}</p>
              <p class="small text-muted">Release: ${m.release_date} â€¢ ${m.duration} min</p>
              <button class="btn btn-primary" onclick="selectMovie(${m.id}, '${m.title.replace(/'/g, "\\'")}')">Select for booking</button>
            </div>
          </div>`;
        grid.appendChild(col);
      });
    }

    function selectMovie(id, title) {
      localStorage.setItem("selected_movie_id", id);
      localStorage.setItem("selected_movie_title", title);
      window.location.href = "/seats/";
    }

    loadMovies();
  </script>
{% endblock %}
